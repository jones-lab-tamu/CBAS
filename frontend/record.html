<!DOCTYPE html>
<html>

<head>
  <title>CBAS/Record</title>

  <script type="text/javascript" src="/eel.js"></script>

  <script type="text/javascript">
	// The default port is 8000. This tells Eel where to connect.
	// Make sure this port matches what app.py is using.
    eel.set_host('ws://localhost:8000');
  </script>

  <link rel="stylesheet" href="index.css" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap CSS -->
  <link href="libs/bootstrap-5.3.3/css/bootstrap.min.css" rel="stylesheet" />
  <link href="libs/bootstrap-icons-1.13.1/bootstrap-icons.css" rel="stylesheet">

</head>

<body class="bg-secondary">
  <nav class="navbar navbar-expand-sm navbar-dark bg-tertiary" style="padding-bottom: 50px">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">CBAS</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav" style="width: 100%">
		<ul class="navbar-nav">
		  <li class="nav-item">
			<button class="nav-link text-white" onclick="routeToRecordPage()">
			  Record
			</button>
		  </li>
		  <li class="nav-item">
			<button class="nav-link" onclick="routeToLabelTrainPage()"> 
			  Label/Train
			</button>
		  </li>
		  <li class="nav-item">
			<button class="nav-link" onclick="routeToVisualizePage()">
			  Visualize
			</button>
		  </li>
		</ul>
      </div>
      <div class="ms-auto">
        <button id="status-camera-outline" class="btn btn-outline-light" style="color: white;" onclick="showStatusModal()" data-bs-toggle="tooltip" data-bs-placement="bottom" title="View System Status">
          <i id="status-camera-icon" class="bi bi-camera" style="font-size: 24px; color: white;"></i>
        </button>
      </div>

    </div>
  </nav>

  <div class="container mt-n5" style="position: relative; z-index: 10;">
    <div class="card bg-dark text-light shadow-sm">
        <div class="card-body d-flex align-items-center">
            <label for="session-name-input" class="form-label mb-0 me-3 fw-bold fs-5 text-nowrap">Current Session Name:</label>
            <input type="text" class="form-control" id="session-name-input" placeholder="Enter a name for this recording session...">
        </div>
    </div>
  </div>

  <div class="container align-items-center justify-content-center mt-4">
    <div class="row" id="camera-container"></div>
  </div>

	<div class="modal" tabindex="-1" id="addCamera">
	  <div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
		  <div class="modal-header">
			<h5 class="modal-title">Add Camera</h5>
			<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		  </div>
		  <div class="modal-body">
			<p>Camera Name:</p>
			<input type="text" class="form-control" id="camera-name-modal-input" aria-describedby="directory" placeholder="e.g. cam1"
			  style="margin-bottom: 10px" />
			<p>RTSP URL:</p>
			<input type="text" class="form-control" id="rtsp-url-modal-input" aria-describedby="directory"
			  placeholder="e.g. rtsp://admin:password@192.168.1.2:8554/profile0" />
		  </div>
		  <div class="modal-footer">
			<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
			  Close
			</button>
			<button type="button" class="btn btn-primary" id="addCameraButton">
			  Add
			</button>
		  </div>
		</div>
	  </div>
	</div>

  <div class="modal" tabindex="-1" id="statusModal">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Current CBAS Status</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <h6>Streams:</h6>
          <p id="status-streams"></p>
          <p id="status-encode-count"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" tabindex="-1" id="errorModal">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Error!</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p id="error-message"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" tabindex="-1" id="cameraSettings">
    <div class="modal-dialog modal-dialog-centered d-flex justify-content-center align-items-center">
      <div class="modal-content" style="width: 800px">
        <div class="modal-header">
          <h5 class="modal-title">Camera Settings</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <canvas id="camera-image" width="600px" height="300px"></canvas>
          <p>Camera Name:</p>
          <input type="text" class="form-control" id="cs-name" aria-describedby="directory" placeholder="e.g. cam1"
            style="margin-bottom: 10px" />
          <p>RTSP URL:</p>
          <input type="text" class="form-control" id="cs-url" aria-describedby="directory"
            placeholder="e.g. rtsp://admin:password@192.168.1.2:8554/profile0" style="margin-bottom: 20px" />

          <div class="container" id="">
            <div class="row justify-content-center align-items-center g-2">
              <div class="col">
                <p>Framerate:</p>
                <input type="number" class="form-control" id="cs-framerate" aria-describedby="directory"
                  placeholder="10" />
              </div>
              <div class="col">
                <p>Left:</p>
                <input type="number" class="form-control" id="cs-cropx" aria-describedby="directory" placeholder="0"
                  step=".01" min="0" max="1" />
              </div>
              <div class="col">
                <p>Right:</p>
                <input type="number" class="form-control" id="cs-crop-width" aria-describedby="directory"
                  placeholder="1" step=".01" min="0" max="1" />
              </div>
            </div>
            <div class="row justify-content-center align-items-center g-2">
              <div class="col">
                <p>Resolution:</p>
                <input type="number" class="form-control" id="cs-resolution" aria-describedby="directory"
                  placeholder="256" />
              </div>
              <div class="col">
                <p>Top:</p>
                <input type="number" class="form-control" id="cs-cropy" aria-describedby="directory" placeholder="0"
                  step=".01" min="0" max="1" />
              </div>
              <div class="col">
                <p>Bottom:</p>
                <input type="number" class="form-control" id="cs-crop-height" aria-describedby="directory"
                  placeholder="1" step=".01" min="0" max="1" />
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="saveCameraSettings()">
            Save
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Right Buttons -->
	<div class="fab-container-right">
	  <!-- Create Button -->
	  <div class="fab" onclick="showAddCameraModal()" data-bs-toggle="tooltip" data-bs-placement="left" title="Add New Camera">
		<i class="bi bi-plus-lg" style="font-size: 50px"></i>
	  </div>

    <!-- Record Button -->
	  <div class="fab" onclick="startAllCameras()" data-bs-toggle="tooltip" data-bs-placement="left" title="Start/Stop All Recordings">
		<i class="bi bi-camera-video-fill"></i>
	  </div>
	</div>

  <!-- Bottom Left Refresh Button -->
	<div class="fab-container-left">
	  <!-- Refresh Button -->
	  <div class="fab" onclick="loadCameras()" data-bs-toggle="tooltip" data-bs-placement="right" title="Refresh Camera Thumbnails">
		<i class="bi bi-arrow-clockwise" style="font-size: 50px"></i>
	  </div>
	</div>

  <div id="cover-spin"></div>

  <div class="progress" id="inference-bar" style="border: 1px solid white"></div>
  
  <!-- =================================================================
  LOG PANEL FOOTER
  ================================================================== -->
  <div class="log-panel-footer">
    <!-- This is the button that toggles the panel -->
    <div class="d-flex justify-content-end p-2 bg-dark">
      <!-- Added tooltip attributes -->
      <button class="btn btn-sm btn-outline-secondary me-2" id="clear-log-btn" data-bs-toggle="tooltip" data-bs-placement="top" title="Clear all messages from the log">Clear Log</button>
      <!-- Added tooltip attributes -->
      <button class="btn btn-sm btn-info" type="button" data-bs-toggle="collapse" data-bs-target="#log-panel-collapse" aria-expanded="false" aria-controls="log-panel-collapse" data-bs-toggle="tooltip" data-bs-placement="top" title="Show/Hide the log panel">
        <i class="bi bi-terminal"></i> View Log
      </button>
    </div>
    <!-- This is the collapsible panel itself -->
    <div class="collapse" id="log-panel-collapse">
      <div id="log-panel-content">
        <!-- Log messages will be appended here by JavaScript -->
      </div>
    </div>
  </div>


  <!-- Bootstrap JS Bundle -->
  <script src="libs/bootstrap-5.3.3/js/bootstrap.bundle.min.js"></script>
  <!-- Custom Page Logic -->
  <script type="text/javascript" src="js/record_page.js"></script>
  <!-- Tooltip Initializer -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
      var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
      })
    });
  </script>
</body>

</html>