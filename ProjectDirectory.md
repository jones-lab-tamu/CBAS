# Understanding the CBAS Project Directory

A CBAS v3 project directory is a self-contained workspace that holds all the data, configurations, trained models, and results for a specific experiment. Understanding this structure is key to managing your data and interpreting your results effectively.

When you create a new project (e.g., `MyCircadianStudy`), CBAS generates the following top-level folders:

```
MyCircadianStudy/
├── cameras/
├── data_sets/
├── models/
└── recordings/
```

Below is a detailed breakdown of each directory and its contents.

---

### 1. The `cameras/` Directory

This folder stores the individual configurations for each physical camera used in the project.

```
cameras/
└── MouseA12/
├── config.yaml
└── frame.jpg
```

*   **`cameras/MouseA12/`**: A subfolder is created for each camera, named by the user on the "Record" page (e.g., `MouseA12`, `Cam_Right_Cage`).
*   **`config.yaml`**: The core configuration file for the camera. It stores settings defined in the UI, such as:
    *   The camera's RTSP URL.
    *   Recording framerate and resolution.
    *   Crop coordinates (`crop_left_x`, `crop_top_y`, etc.) for isolating the region of interest.
*   **`frame.jpg`**: A single-frame thumbnail of the camera's view, automatically generated by `ffmpeg`. This image is displayed on the camera cards in the "Record" page UI for easy identification.

---

### 2. The `data_sets/` Directory

This folder is the heart of the training process. It contains all user-created datasets, including the labeled data and the resulting performance reports from model training.

```
data_sets/
└── CircadianBehaviorDataset/
├── config.yaml
├── labels.yaml
├── confusion_matrix_BEST.png
├── f1-score_epochs_plot.png
└── performance_report.yaml
```

*   **`data_sets/CircadianBehaviorDataset/`**: A subfolder for each dataset created by the user on the "Label/Train" page.
*   **`config.yaml`**: Stores the dataset's metadata, including:
    *   The list of `behaviors` to be classified (e.g., `eating; drinking; resting`).
    *   A `whitelist` of recording directories to be included for labeling.
    *   The saved performance `metrics` (Precision, Recall, F1) that are displayed on the dataset card in the UI after a model has been trained.
*   **`labels.yaml`**: This critical file stores all the human-verified labels. When a user clicks **Commit Corrections** in the labeling interface, this file is updated with the new start/end frames and behavior names for each instance.
*   **`performance_report.yaml`**: A machine-readable file containing the detailed performance metrics (precision, recall, f1-score, support) for the best-performing model trained on this dataset.
*   **`confusion_matrix_BEST.png`**: An image of the confusion matrix for the best model. This visually shows the user which behaviors the model is confusing with others.
*   **`f1-score_epochs_plot.png`** (and others for precision/recall): These plots show how the model's performance on each behavior changed during the training process (over epochs). This helps diagnose training issues and determine if more training time is needed.

---

### 3. The `models/` Directory

This folder stores the output of the training process: the trained models themselves.

```
models/
└── CircadianBehaviorDataset/
├── config.yaml
└── model.pth
```

> **Note:** The default `JonesLabModel` is a special case, bundled with the application's source code, and will not appear inside a user's project `models` folder unless they create a new model with the same name.

*   **`models/CircadianBehaviorDataset/`**: A subfolder for each successfully trained model, typically named after the dataset it was trained on.
*   **`config.yaml`**: A simple configuration file that stores the essential parameters the model was built with, namely the `sequence_length` and the ordered list of `behaviors` it can predict.
*   **`model.pth`**: The actual trained model weights, saved as a PyTorch state dictionary. This file is loaded by the `ClassificationThread` for inference.

---

### 4. The `recordings/` Directory

This is where all the raw and processed video data resides, organized hierarchically by session and subject/camera. This structured approach is key to CBAS's data management.

```
recordings/
└── 2024-05-21_Session1/
└── MouseA12/
├── MouseA12_00000.mp4
├── MouseA12_00000_cls.h5
├── MouseA12_00000_CircadianBehaviorDataset_outputs.csv
├── MouseA12_00000_AnotherModel_outputs.csv
└── MouseA12_00001.mp4
```

*   **`recordings/2024-05-21_Session1/`**: A top-level folder for a recording session, named by the user on the "Record" page or during video import.
*   **`MouseA12/`**: A subfolder for the specific subject or camera being recorded in that session.
*   **`MouseA12_00000.mp4`**: The raw, segmented video file captured by `ffmpeg`. A new segment is created periodically (e.g., every 10 minutes).
*   **`MouseA12_00000_cls.h5`**: The **feature embedding file**. After a video segment is created, the `EncodeThread` processes it with the DINOv2 model and saves the resulting high-dimensional feature vectors (one per frame) into this HDF5 file. This is the input for all subsequent ML tasks.
*   **`MouseA12_00000_CircadianBehaviorDataset_outputs.csv`**: The final **classification output**. This CSV file is generated by the `ClassificationThread` and contains the frame-by-frame probabilities for each behavior defined in the specified model (in this case, `CircadianBehaviorDataset`). A single `.h5` file can have multiple `_outputs.csv` files associated with it if it has been classified by different models.